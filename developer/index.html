

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer Guide &mdash; ITUCSDB1920 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="User Guide" href="../user/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1920
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#database-design">Database Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#book-table">BOOK Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bookworm-table">BOOKWORM Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review-table">REVIEW Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#author-table">AUTHOR Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#genres-table">GENRES Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#admins-table">ADMINS Table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#code-structure">Code Structure</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1920</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Developer Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developer-guide">
<h1>Developer Guide<a class="headerlink" href="#developer-guide" title="Permalink to this headline">¶</a></h1>
<p>This guide is intended for developers to help them understand the structure of Readvice.
All the dependencies are listed in requirements.txt file.
Users can run the following command to install the dependencies:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="database-design">
<h2>Database Design<a class="headerlink" href="#database-design" title="Permalink to this headline">¶</a></h2>
<p>Entity-Relationship Diagram and detailed explanation
of each entity are given below:</p>
<blockquote>
<div><div class="figure align-default" id="id1">
<a class="reference internal image-reference" href="../_images/ERDiagram.png"><img alt="Entity Relationship Diagram" src="../_images/ERDiagram.png" style="width: 721.0px; height: 475.0px;" /></a>
<p class="caption"><span class="caption-text">Entity Relationship Diagram of Readvice.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
<p>There are 6 tables in the database:
BOOK, BOOKWORM, REVIEW, AUTHOR, GENRES and ADMINS.</p>
<div class="section" id="book-table">
<h3>BOOK Table<a class="headerlink" href="#book-table" title="Permalink to this headline">¶</a></h3>
<p>Holds the information about books.
There are 7 fields available:</p>
<ul class="simple">
<li><p>ID: Unique id generated by PostgreSQL</p></li>
<li><p>TITLE: Title of the book, cannot be empty</p></li>
<li><p>AUTHORID: Author of the book, foreign key to AUTHOR table</p></li>
<li><p>YR: Publication year, must be between 0 and 2019</p></li>
<li><p>PGNUM: Number of pages the book has, must be greater than 0</p></li>
<li><p>COVER: A link to cover page of the book</p></li>
<li><p>DESCRIPTION: A summary of the book</p></li>
</ul>
</div>
<div class="section" id="bookworm-table">
<h3>BOOKWORM Table<a class="headerlink" href="#bookworm-table" title="Permalink to this headline">¶</a></h3>
<p>User information is stored in this table.
There are 6 fields available:</p>
<ul class="simple">
<li><p>ID: Unique id generated by PostgreSQL</p></li>
<li><p>USERNAME: Username of the user, cannot be empty</p></li>
<li><p>EMAIL: Email address of the user, cannot be empty</p></li>
<li><p>PASSWORD: Password of the user in hashed form, cannot be empty</p></li>
<li><p>PROFILEPICTURE: Name of the profile picture file stored in filesystem</p></li>
<li><p>GENDER: Gender field.</p></li>
</ul>
</div>
<div class="section" id="review-table">
<h3>REVIEW Table<a class="headerlink" href="#review-table" title="Permalink to this headline">¶</a></h3>
<p>User reviews for books are stored here.
There are 6 fields available:</p>
<ul class="simple">
<li><p>ID: Unique id generated by PostgreSQL</p></li>
<li><p>SCORE: An integer value between 1 and 10.</p></li>
<li><p>COMMENT: Comment about the book.</p></li>
<li><p>DATEWRITTEN: A time stamp, automatically generated.</p></li>
<li><p>BOOKID: The book that review belongs to, foreign key to BOOK table</p></li>
<li><p>USERID: Owner of the review, foreign key to BOOKWORM table</p></li>
</ul>
</div>
<div class="section" id="author-table">
<h3>AUTHOR Table<a class="headerlink" href="#author-table" title="Permalink to this headline">¶</a></h3>
<p>Author information is stored in this table.
There are 4 fields available:</p>
<ul class="simple">
<li><p>ID: Unique id generated by PostgreSQL</p></li>
<li><p>NAME: Name of the author, cannot be empty</p></li>
<li><p>DESCRIPTION: Information about the author</p></li>
<li><p>PHOTO: A link to the author’s photo</p></li>
</ul>
</div>
<div class="section" id="genres-table">
<h3>GENRES Table<a class="headerlink" href="#genres-table" title="Permalink to this headline">¶</a></h3>
<p>Genres of a certain book are kept in this table. It includes 1 row for every genre.
There are 2 fields:</p>
<ul class="simple">
<li><p>BOOKID: The book that belongs to this genre, foreign key to BOOK table</p></li>
<li><p>GENRE: Name of the genre</p></li>
</ul>
</div>
<div class="section" id="admins-table">
<h3>ADMINS Table<a class="headerlink" href="#admins-table" title="Permalink to this headline">¶</a></h3>
<p>A list of admins. Only 1 field available:</p>
<ul class="simple">
<li><p>ADMINID: ID of an admin, foreign key to BOOKWORM table</p></li>
</ul>
</div>
</div>
<div class="section" id="code-structure">
<h2>Code Structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>dbinit.py file contains all the necessary information to create the database.
Database is initialized using the following queries:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INIT_STATEMENTS</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s2">&quot;DROP TABLE IF EXISTS REVIEW&quot;</span><span class="p">,</span>
   <span class="s2">&quot;DROP TABLE IF EXISTS ADMINS&quot;</span><span class="p">,</span>
   <span class="s2">&quot;DROP TABLE IF EXISTS BOOKWORM&quot;</span><span class="p">,</span>
   <span class="s2">&quot;DROP TABLE IF EXISTS GENRES&quot;</span><span class="p">,</span>
   <span class="s2">&quot;DROP TABLE IF EXISTS BOOK&quot;</span><span class="p">,</span>
   <span class="s2">&quot;DROP TABLE IF EXISTS AUTHOR&quot;</span><span class="p">,</span>

   <span class="sd">&quot;&quot;&quot;CREATE TABLE AUTHOR(</span>
<span class="sd">      ID SERIAL PRIMARY KEY,</span>
<span class="sd">      NAME VARCHAR(50) NOT NULL,</span>
<span class="sd">      DESCRIPTION VARCHAR(2000),</span>
<span class="sd">      PHOTO VARCHAR(200)</span>
<span class="sd">   )&quot;&quot;&quot;</span><span class="p">,</span>

   <span class="sd">&quot;&quot;&quot;CREATE TABLE BOOK(</span>
<span class="sd">      ID SERIAL PRIMARY KEY,</span>
<span class="sd">      TITLE VARCHAR(80) NOT NULL,</span>
<span class="sd">      YR INTEGER CHECK(YR&gt;=0 AND YR&lt;=2019),</span>
<span class="sd">      AUTHORID INTEGER REFERENCES AUTHOR ON DELETE SET NULL,</span>
<span class="sd">      PGNUM INTEGER CHECK(PGNUM&gt;=0),</span>
<span class="sd">      COVER VARCHAR(200),</span>
<span class="sd">      DESCRIPTION VARCHAR(2000)</span>
<span class="sd">   )&quot;&quot;&quot;</span><span class="p">,</span>

   <span class="sd">&quot;&quot;&quot;CREATE TABLE BOOKWORM(</span>
<span class="sd">      ID SERIAL PRIMARY KEY,</span>
<span class="sd">      USERNAME VARCHAR(20) UNIQUE NOT NULL,</span>
<span class="sd">      PASSWORD VARCHAR(100) NOT NULL,</span>
<span class="sd">      EMAIL VARCHAR(50) UNIQUE NOT NULL,</span>
<span class="sd">      PROFILEPICTURE VARCHAR(30),</span>
<span class="sd">      GENDER VARCHAR(10)</span>
<span class="sd">   )&quot;&quot;&quot;</span><span class="p">,</span>

   <span class="sd">&quot;&quot;&quot;CREATE TABLE REVIEW(</span>
<span class="sd">      ID SERIAL PRIMARY KEY,</span>
<span class="sd">      SCORE INTEGER NOT NULL CHECK(SCORE&gt;=1 AND SCORE&lt;=10),</span>
<span class="sd">      COMMENT VARCHAR(2000),</span>
<span class="sd">      DATEWRITTEN TIMESTAMP,</span>
<span class="sd">      BOOKID INTEGER REFERENCES BOOK ON DELETE CASCADE,</span>
<span class="sd">      USERID INTEGER REFERENCES BOOKWORM ON DELETE CASCADE</span>
<span class="sd">   )&quot;&quot;&quot;</span><span class="p">,</span>

   <span class="sd">&quot;&quot;&quot;CREATE TABLE ADMINS(</span>
<span class="sd">      ADMINID INTEGER UNIQUE REFERENCES BOOKWORM ON DELETE CASCADE</span>
<span class="sd">   )&quot;&quot;&quot;</span><span class="p">,</span>

   <span class="sd">&quot;&quot;&quot;CREATE TABLE GENRES(</span>
<span class="sd">      BOOKID INTEGER REFERENCES BOOK ON DELETE CASCADE,</span>
<span class="sd">      GENRE VARCHAR(20)</span>
<span class="sd">   )&quot;&quot;&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Initialization functions:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
   <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">INIT_STATEMENTS</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
   <span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: DATABASE_URL=url python dbinit.py&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="n">initialize</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Database is initialized using “DATABASE_URL=url python dbinit.py” command.
It requires a valid database url to be entered.</p>
<p>Explanation and an example of what each file does is given below:</p>
<p>All the routes are created and the application is initialized in server.py file.
An example of adding routes to the application is given below:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">views</span><span class="o">.</span><span class="n">home_page</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>View functions for routes are stored in views.py file.
View function of home page is given below:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">home_page</span><span class="p">():</span>
   <span class="n">searchform</span><span class="o">=</span><span class="n">SearchForm</span><span class="p">()</span>
   <span class="n">db</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;db&quot;</span><span class="p">]</span>
   <span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_top_books</span><span class="p">()</span>
   <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;home.html&quot;</span><span class="p">,</span> <span class="n">books</span><span class="o">=</span><span class="n">books</span><span class="p">,</span> <span class="n">searchform</span><span class="o">=</span><span class="n">searchform</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>database.py file contains the functions to interact with the database.
The function that returns the Top 10 books in the database is given below:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_top_books</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="n">books</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT BOOK.ID, BOOK.TITLE, BOOK.YR, BOOK.COVER, AVG(REVIEW.SCORE)</span>
<span class="s2">      FROM BOOK INNER JOIN REVIEW ON BOOK.ID = REVIEW.BOOKID</span>
<span class="s2">      GROUP BY BOOK.ID, BOOK.TITLE, BOOK.YR, BOOK.COVER</span>
<span class="s2">      ORDER BY AVG(REVIEW.SCORE) DESC</span>
<span class="s2">      LIMIT 10&quot;&quot;&quot;</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">book_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">cover</span><span class="p">,</span> <span class="n">avgscore</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
          <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Book</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">book_id</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">cover</span><span class="o">=</span><span class="n">cover</span><span class="p">,</span> <span class="n">avgscore</span><span class="o">=</span><span class="n">avgscore</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">books</span>
</pre></div>
</div>
</div></blockquote>
<p>forms.py file contains forms created with WTForms package.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SearchForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
   <span class="n">query</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s2">&quot;Search...&quot;</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()])</span>
</pre></div>
</div>
</div></blockquote>
<p>author.py, book.py, review.py and user.py files contain
classes for author, book, review and bookworm entities.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Review</span><span class="p">:</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">book</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datewritten</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">book</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">datewritten</span> <span class="o">=</span> <span class="n">datewritten</span>
</pre></div>
</div>
</div></blockquote>
<p>settings.py file contains basic configuration for the applicataion.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../user/index.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ITUCSDB1920

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>